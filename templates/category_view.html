{% extends "layout.html" %}
{% block content %}

<div class="category-nav d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
    <h2 class="text-white mb-0">{{ category.name }}</h2>

    <div class="dropdown ms-md-auto">
        <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Ir a otra categoría
        </button>
        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
            <li><a class="dropdown-item" href="{{ url_for('index') }}">Inicio</a></li>
            <li><hr class="dropdown-divider"></li>
            {% for other in other_categories | default([]) %}
            <li>
                <a class="dropdown-item" href="{{ url_for('show_category', id=other._id|string) }}">
                    {{ other.name }}
                </a>
            </li>
            {% else %}
            <li><span class="dropdown-item-text text-muted">Sin otras categorías</span></li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="row g-3">
    {% for p in products %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <div class="flip-card-container">
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
                <!-- Frente de la carta -->
                <div class="flip-card-front card card-category text-white h-100">
                    <div class="card-img-wrap">
                        {% if p.image %}
                        <img src="{{ p.image }}" class="card-img-top" alt="{{ p.name }}">
                        {% else %}
                        <img src="{{ url_for('static', filename='uploads/default.jpg') }}" class="card-img-top" alt="{{ p.name }}">
                        {% endif %}
                    </div>
                    <div class="card-img-overlay d-flex flex-column justify-content-end p-3 overlay-dark">
                        <h5 class="card-title text-white mb-0">{{ p.name }}</h5>
                    </div>
                </div>
                
                <!-- Reverso de la carta -->
                <div class="flip-card-back card card-category text-white h-100 d-flex flex-column justify-content-center p-3">
                    <h5 class="card-title text-center mb-3">{{ p.name }}</h5>
                    
                    {% if category.name.upper() == "PIZZAS" %}
                    <!-- PIZZAS: Precios por tamaño e ingredientes -->
                    <div class="mb-3">
                        <h6 class="text-neon text-center mb-2">Precios por Tamaño:</h6>
                        <ul class="list-unstyled small">
                            {% if p.price_individual %}
                            <li class="mb-1">Individual: <strong class="text-neon">${{ p.price_individual }}</strong></li>
                            {% endif %}
                            {% if p.price_chica %}
                            <li class="mb-1">Chica: <strong class="text-neon">${{ p.price_chica }}</strong></li>
                            {% endif %}
                            {% if p.price_mediana %}
                            <li class="mb-1">Mediana: <strong class="text-neon">${{ p.price_mediana }}</strong></li>
                            {% endif %}
                            {% if p.price_grande %}
                            <li class="mb-1">Grande: <strong class="text-neon">${{ p.price_grande }}</strong></li>
                            {% endif %}
                            {% if p.price_h4 %}
                            <li class="mb-1">H4: <strong class="text-neon">${{ p.price_h4 }}</strong></li>
                            {% endif %}
                        </ul>
                    </div>
                    {% if p.ingredients %}
                    <div class="mb-2">
                        <h6 class="text-neon text-center mb-1">Ingredientes:</h6>
                        <p class="small mb-0 text-center">{{ p.ingredients }}</p>
                    </div>
                    {% endif %}

                    {% elif category.name.upper() == "BEBIDAS" %}
                    <!-- BEBIDAS: Precio y ML -->
                    <div class="mb-3 text-center">
                        <h6 class="text-neon mb-2">Precio:</h6>
                        <p class="fs-3 mb-2"><strong class="text-neon">${{ p.price }}</strong></p>
                        {% if p.ml %}
                        <p class="mb-0"><strong>Contenido:</strong> {{ p.ml }} ml</p>
                        {% endif %}
                    </div>

                    {% elif category.name.upper() == "COMPLEMENTOS" %}
                    <!-- COMPLEMENTOS: Precio, gramos e ingredientes (solo algunos) -->
                    <div class="mb-3 text-center">
                        <h6 class="text-neon mb-2">Precio:</h6>
                        <p class="fs-3 mb-2"><strong class="text-neon">${{ p.price }}</strong></p>
                        {% if p.grams %}
                        <p class="mb-2"><strong>Peso:</strong> {{ p.grams }} g</p>
                        {% endif %}
                    </div>
                    {% if p.ingredients %}
                    <div class="mb-2">
                        <h6 class="text-neon text-center mb-1">Ingredientes:</h6>
                        <p class="small mb-0 text-center">{{ p.ingredients }}</p>
                    </div>
                    {% endif %}

                    {% else %}
                    <!-- Otras categorías: Precio genérico -->
                    <div class="mb-3 text-center">
                        <h6 class="text-neon mb-2">Precio:</h6>
                        <p class="fs-3 mb-0"><strong class="text-neon">${{ p.price }}</strong></p>
                    </div>
                    {% endif %}
                    
                    <p class="text-center small text-muted mt-auto mb-0" style="font-size: 0.75rem;">Click para voltear</p>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not products %}
<div class="alert alert-info text-center">
    <p class="mb-0">No hay productos disponibles en esta categoría.</p>
</div>
{% endif %}

<style>
.flip-card-container {
    perspective: 1000px;
    height: 100%;
}

.flip-card {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 260px;
    transform-style: preserve-3d;
    transition: transform 0.6s;
    cursor: pointer;
}

.flip-card.flipped {
    transform: rotateY(180deg);
}

.flip-card-front,
.flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.flip-card-back {
    transform: rotateY(180deg);
    overflow-y: auto;
}

/* Responsive para flip cards */
@media (max-width: 768px) {
    .flip-card {
        min-height: 220px;
    }
}

@media (max-width: 576px) {
    .flip-card {
        min-height: 200px;
    }
    
    .flip-card-back {
        padding: 1rem !important;
    }
    
    .flip-card-back h5 {
        font-size: 1rem !important;
        margin-bottom: 0.75rem !important;
    }
    
    .flip-card-back h6 {
        font-size: 0.9rem !important;
    }
    
    .flip-card-back .fs-3 {
        font-size: 1.5rem !important;
    }
    
    .flip-card-back ul {
        font-size: 0.8rem;
    }
    
    .flip-card-back .small {
        font-size: 0.75rem !important;
    }
}

@media (max-width: 400px) {
    .flip-card {
        min-height: 180px;
    }
    
    .flip-card-back {
        padding: 0.75rem !important;
    }
    
    .flip-card-back h5 {
        font-size: 0.95rem !important;
        margin-bottom: 0.5rem !important;
    }
    
    .flip-card-back .fs-3 {
        font-size: 1.3rem !important;
    }
}
</style>

{% endblock %}
